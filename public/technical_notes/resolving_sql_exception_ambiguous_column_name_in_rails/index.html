<!doctype html><html><head><meta charset=utf-8><title>brendan tang</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/style.css></head><body><div class=wrapper><header class=site-header><a href=/>brendan tang</a><nav class=icon-tags><a title=Posts href=/technical_notes/>POSAT</a>
8
| <a title=tags href=/tags>üè∑</a></nav></header><div id=content><article><h1>Resolving SQLException: ambiguous column name in a Rails project</h1><aside>2020-10-12 14:45:19 -0400 EDT</aside><p>In my current project, I have a model concern which contains shared scopes for filtering and sorting records.
For instance, I have the models <code>recipes,</code> <code>batches,</code> and <code>pack_dates.</code>
Both <code>recipe</code> and <code>pack_date</code> are associated with a <code>recipe</code> through a <code>belongs_to</code> association.</p><p>By including my <code>FilteringScopes</code> module, both <code>batch</code> and <code>pack_date</code> get access to a <code>with_recipe</code> scope which returns only those records which belong to the given recipe (among other filtering and sorting scopes).</p><pre><code># app/models/concerns/filtering_scopes.rb
 
require 'active_support/concern'

module FilteringScopes
  extend ActiveSupport::Concern

  included do

    scope :with_recipe,
          lambda { |recipe_code|
            where(recipe: Recipe.find_by(code: recipe_code))
          }
</code></pre><p>Initially I had the <code>with_recipe</code> scope written like this:</p><pre><code>scope :with_recipe,
      lambda { |recipe_code|
        where('recipe_id = ?', Recipe.find_by(code: recipe_code).id)
      }
</code></pre><p>But I found that using this string format would get me into trouble in some situations where Rails didn&rsquo;t know whether to look at the <code>recipe_id</code> column of the <code>pack_dates</code> table or the <code>batches</code> table, and I would get this error:</p><pre><code>ActionView::Template::Error: SQLite3::SQLException: ambiguous column name: recipe_id
</code></pre><p>Switching from the string form of the <code>where</code> method to the hash form resolved this for me.</p></article><nav class=sidebar><h3>Tags</h3><ul><li><a href=/tags/rails/>rails</a></li><li>üíª <a href=/tags/technical-notes/>technical notes</a></li></ul><hr><h3>Adjacent</h3><div><a href=/technical_notes/find_and_replace_text_in_all_files_vim_grep/>‚Üê Find and Replace text in all files that contain it using VIM and grep</a><br>- - -<br><a href=/technical_notes/deploying_a_ghost_site_on_dokku/>Deploying a Ghost Site on Dokku ‚Üí</a></div><div><h3>Related</h3><ul><li><a href=/technical_notes/find_and_replace_text_in_all_files_vim_grep/>Find and Replace text in all files that contain it using VIM and grep</a></li></ul></div></nav></div><footer style=max-width:100%><a href=/><img style=max-width:100% src=/glasses.svg></a></footer></div></body></html>